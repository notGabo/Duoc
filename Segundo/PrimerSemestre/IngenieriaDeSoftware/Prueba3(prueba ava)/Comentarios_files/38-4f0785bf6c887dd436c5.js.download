(window.webpackJsonp=window.webpackJsonp||[]).push([[38],{"2o5C":function(e,t,i){"use strict";i.d(t,"e",(function(){return T})),i.d(t,"d",(function(){return A})),i.d(t,"c",(function(){return w})),i.d(t,"b",(function(){return D})),i.d(t,"a",(function(){return _}));var s=i("D57K"),a=i("Llzl"),o=i("aHpC"),n=i("8W6D"),r=i("Sa5G"),c=i("tka7"),l=i("oi1r"),d=i("P2dS"),u=i("+4Px"),h=i("0JpG"),m=i("lEL+"),p=i("TnpK"),g=i("JNtI"),y=i("MoIS"),b=i("jhBu"),S=i("X/qj"),f=i("Fvsw"),C=i("r6lH"),v=i("o5Lu"),E=i("nmzr"),$=i("cR84"),N=i("zGdY");const T="ultra.features.course.grades.gradesSettings.controller",A="update-telemetry-settings",w="bb-update-grade-settings-overall-grade",D="refresh-after-update-settings";let _=class e{constructor(e,t,i,s,o,c,l,d,u,h,m,p,g,y,b,S){this.$scope=e,this.$rootScope=t,this.$q=i,this.course=s,this.$modal=o,this.localizeService=c,this.timeout=l,this.GradeNotationModel=d,this.ultraState=u,this.schemaService=h,this.categoryService=m,this.gradebookPermissionService=p,this.entitlementService=g,this.context=y,this.telemetry=b,this.grade=S,this.isShowSettingPage=!0,this.isSchemaTitleEditable=!1,this.notations=[],this.isCodeValidate=!0,this.hasTelemetryData=!1,this.showAddNewCategory=!1,this.newCategoryName="",this.isInputBluredByCancelAdd=!1,this.isInputBlurredByCancelButton=!1,this.currentEditedCategory=null,this.focusNotationEventName="add-notation-button-focus",this.isPastZeroAssigned=!0,e.gradesSettings=this,this.courseId=this.ultraState.nextParams.courseId,this.hasGradebookModifyAccess=this.gradebookPermissionService.canModify(),this.hasContentDeleteAccess=this.entitlementService.isEntitled(r.e.DeleteContent,this.courseId),this.hasContentModifyAccess=this.entitlementService.isEntitled(r.e.ModifyContent,this.courseId),this.hasContentCreateAccess=this.entitlementService.isEntitled(r.e.CreateContent,this.courseId),this.canViewTelemetrySettingsUI=this.hasContentDeleteAccess&&this.hasContentModifyAccess&&this.hasContentCreateAccess,s&&(h.loadSchemas(s).then(e=>{e.forEach(e=>{e.localizableTitle&&(e.ui.displayTitle=this.localizeService.translateSync({locale:this.localizeService.getLocale(this.$scope),key:e.ui.displayTitleKey}))}),this.schemas=e.filter(e=>e.scaleType===N.SchemaScaleType.Tabular)}),s.gradebook.settings.$resolve().$then(e=>{this.gradebookSettings=e,this.isPastZeroAssigned=e.countUnsubmittedWorkAsZero,this.isPastZeroCompleted=this.course.isComplete()}),this.categoryService.getOrLoadCategoriesForCourse(s.id,!0).then(e=>{this.categories=e}),s.gradebook.performancecodes.$refresh().$then(e=>{e.forEach(e=>{const t={model:e,id:this.generateNotationId(),isEditing:!1,code:e.code,description:e.description};this.notations.push(t)}),this.notations.permissions=e.permissions}),this.loadOverallGradeColumn(S),this.loadTelemetrySettings(s),this.$scope.$on(A,(e,t)=>{this.studentFailingThreshold=t.studentFailingThreshold,this.studentAbsentThreshold=t.studentAbsentThreshold,this.studentAlertsEnabled=t.studentAlertsEnabled}),this.$scope.$on(w,(e,t,i)=>{this.hasOverallGradeColumn=i,this.overallGradeColumnId=t})),this.validationManager={isEmpty:e=>!e,isNotationNumberOnly:e=>!Number.isNaN(Number(e)),isNotationExist:e=>this.notations.some(t=>t!==e&&t.code===e.code),isNotationSchemaDuplicate:e=>this.schemas[0].symbols.some(t=>t.symbol===e.code),isCategoryDuplicate:(e,t)=>this.categories.some(i=>{if(i===t)return!1;let s=i.localizableTitle.languageKey;return i.isUserDefined||(s=s.substr(0,s.indexOf("."))),s.toLocaleLowerCase()===e.toLocaleLowerCase()}),execute:(e,...t)=>{const i=this.validationManager;return i[e]&&i[e].apply(i,[].slice.call(t,0))}},this.validationManager.execute(),this.entitlementService.hasCourseEntitlement(r.k.CreateRubrics,this.courseId).then(t=>{e.hasRubricCreateAccess=t}),this.context.getSystemInfo().$asPromise().then(e=>{e.telemetryEnabled&&(this.hasTelemetryData=!0)}),e.$on("$stateChangeStart",(t,i,s,a,o)=>{if(a.name.endsWith(E.GradeRoutes.GRADE_SETTING)&&!i.name.endsWith(E.GradeRoutes.GRADE_SETTING)&&e.gradesSettings.saveTelemetrySettings(),a.name===i.name||e.gradeSchemasPanelForm&&(!e.gradeSchemasPanelForm||e.gradeSchemasPanelForm.$dirty)){if(i.name.indexOf("rubric.mode")>1&&n.a.COPY.isEqualTo(n.a.parse(s.mode)))return!0;t.preventDefault()}else this.leaveEditMode(this.activeNotation,"confirm")}),e.$watch("gradeSchemasPanelForm.$dirty",()=>{this.isShowSettingPage||(e.gradeSchemasPanelForm&&e.gradeSchemasPanelForm.$dirty?(a.element(".bb-offcanvas-panel.peek .bb-close").hide(),a.element(".bb-offcanvas-panel.peek .panel-wrap").addClass("has-footer")):(a.element(".bb-offcanvas-panel.peek .bb-close").show(),a.element(".bb-offcanvas-panel.peek .panel-wrap").removeClass("has-footer")))})}loadOverallGradeColumn(e){e.loadColumns(this.courseId,!0).then(e=>{const t=e.find(e=>e.externalGrade);t&&!this.overallGradeColumnId?(this.hasOverallGradeColumn=!0,this.overallGradeColumnId=t.id):this.hasOverallGradeColumn=!1})}loadTelemetrySettings(t){t.preferences.getPreference(e.INITIAL_FAILING_PREF_ARGS).then(e=>{this.studentFailingThreshold=e.value&&!Number.isNaN(Number(e.value))?Number(e.value):void 0}),t.preferences.getPreference(e.INITIAL_ABSENT_PREF_ARGS).then(t=>{null==t.value?this.studentAbsentThreshold=e.STUDENT_ABSENT_DEFAULT:0===Number(t.value)||Number.isNaN(Number(t.value))?this.studentAbsentThreshold=void 0:this.studentAbsentThreshold=Number(t.value)}),t.preferences.getPreference(e.INITIAL_ENABLE_PREF_ARGS).then(e=>{this.studentAlertsEnabled=e.value})}set postOption(e){this.gradebookSettings.promptUserToPostWhenDone="true"===e}get postOption(){return this.gradebookSettings&&this.gradebookSettings.promptUserToPostWhenDone?"true":"false"}switchView(e,t){this.isShowSettingPage=e,t&&(this.currentViewSchema=t,this.originCurrentViewSchema=a.copy(this.currentViewSchema))}goToTelemetryView(){this.ultraState.goPeekState(E.TelemetryRoutes.INSTRUCTOR_CLASS)}toggleSchemaTitleEditable(){this.course.isComplete()||(!this.isSchemaTitleEditable||this.currentViewSchema.title&&this.currentViewSchema.title.length>0)&&(this.isSchemaTitleEditable?this.currentViewSchema.ui.displayTitle=this.currentViewSchema.title:this.currentViewSchema.localizableTitle?this.currentViewSchema.title=this.localizeService.translateSync({locale:this.localizeService.getLocale(this.$scope),key:this.originCurrentViewSchema.ui.displayTitleKey}):this.currentViewSchema.title=this.originCurrentViewSchema.ui.displayTitle,this.isSchemaTitleEditable=!this.isSchemaTitleEditable)}adjustLowerBound(e,t){if(t<this.currentViewSchema.symbols.length-1){const i=this.currentViewSchema.symbols[t+1];i.upperBound=e.lowerBound,i.absoluteTranslation=(i.lowerBound+i.upperBound)/2}e.absoluteTranslation=(e.lowerBound+e.upperBound)/2}isValidSymbolStr(e){let t=0;for(let i=0;i<this.currentViewSchema.symbols.length;i++)this.currentViewSchema.symbols[i].symbol===e.symbol&&t++;return 1===t}addSymbol(e,t){if(!(t<this.currentViewSchema.symbols.length-1))throw new Error("Can not add a symbol to the last symbol in the array.");{const i=this.currentViewSchema.symbols[t+1],s=(i.lowerBound+i.upperBound)/2;this.currentViewSchema.symbols.splice(t+1,0,{schemaId:e.schemaId,lowerBound:s,upperBound:i.upperBound,absoluteTranslation:(s+i.upperBound)/2,symbol:void 0}),i.upperBound=s,i.absoluteTranslation=(i.lowerBound+i.upperBound)/2,this.currentViewSchema.symbols[t+2]=i,this.timeout(()=>{this.$scope.$broadcast("bb-grades-schema-symbol-change",{action:"add",index:t+1})},this.$scope)}}deleteSymbol(e,t){if(!(t!==this.currentViewSchema.symbols.length-1&&this.currentViewSchema.symbols.length>2))throw new Error("Can not delete the two last symbols in the array.");{const i=this.currentViewSchema.symbols[t+1];i.upperBound=e.upperBound,i.absoluteTranslation=(i.lowerBound+i.upperBound)/2,this.currentViewSchema.symbols.splice(t,1),this.timeout(()=>{this.$scope.$broadcast("bb-grades-schema-symbol-change",{action:"delete",index:t})},this.$scope)}}validate(){var e;return null===(e=this.$scope.gradeSchemasPanelForm)||void 0===e?void 0:e.$valid}cancel(){a.copy(this.originCurrentViewSchema.symbols,this.currentViewSchema.symbols),this.currentViewSchema.title=this.originCurrentViewSchema.title,this.currentViewSchema.localizableTitle?this.currentViewSchema.ui.displayTitle=this.localizeService.translateSync({locale:this.localizeService.getLocale(this.$scope),key:this.originCurrentViewSchema.ui.displayTitleKey}):this.currentViewSchema.ui.displayTitle=this.originCurrentViewSchema.ui.displayTitle,this.$scope.gradeSchemasPanelForm.$setPristine()}save(){this.currentViewSchema.$patch().$then(e=>{this.$rootScope.$broadcast("bb-grades-schema-save",e),this.originCurrentViewSchema=a.copy(this.currentViewSchema),this.originCurrentViewSchema.title=this.currentViewSchema.title,this.$scope.gradeSchemasPanelForm.$setPristine()})}validateTelemetrySettings(){var e;return null===(e=this.$scope.telemetrySettingsForm)||void 0===e?void 0:e.$valid}saveTelemetrySettings(){if(!this.course||!this.canViewTelemetrySettingsUI)return this.$q.when(!0);const t={key:e.STUDENT_FAILING_PREFERENCE_KEY,value:this.studentFailingThreshold,visibleToStudents:!0},i={key:e.STUDENT_ABSENT_PREFERENCE_KEY,value:this.studentAbsentThreshold?this.studentAbsentThreshold:e.DISABLE_ABSENT_NOTICES,visibleToStudents:!0},s={key:e.STUDENT_ALERTS_ENABLED,value:this.studentAlertsEnabled,visibleToStudents:!0};return null!=this.studentFailingThreshold?this.$q.all([this.course.preferences.setPreference(t),this.course.preferences.setPreference(i),this.course.preferences.setPreference(s)]):this.$q.all([this.course.preferences.deletePreference(e.STUDENT_FAILING_PREFERENCE_KEY),this.course.preferences.setPreference(i),this.course.preferences.setPreference(s)])}getCourseColor(){return this.$scope.course.courseColorClass}addNewCategory(){this.currentEditedCategory&&this.cancelEditCategory(this.currentEditedCategory),this.isInputBluredByCancelAdd=!1,this.showAddNewCategory=!0,this.timeout(()=>{a.element("#add-new-category-input").on("keydown",e=>{e.keyCode!==u.u||e.shiftKey||(this.isInputBluredByCancelAdd=!0)});const e=a.element("#cancel-add-category-button");e.on("mousedown",()=>{this.isInputBluredByCancelAdd=!0}),e.on("keydown",e=>{e.keyCode===u.u&&e.shiftKey?this.isInputBluredByCancelAdd=!1:e.keyCode===u.u&&(this.isInputBluredByCancelAdd=!1,this.validateAndAddCategory())})},this.$scope,0,!1)}cancelAddNewCategory(){this.newCategoryName="",this.showAddNewCategory=!1,this.clearValidationForAddCategory()}editCategory(e){this.showAddNewCategory&&this.cancelAddNewCategory(),this.currentEditedCategory&&this.cancelEditCategory(this.currentEditedCategory),this.switchEditMode(e,!0),e.isUserDefined&&this.timeout(()=>{a.element("#cancel-update-category-button-"+e.id).on("mousedown",()=>{this.isInputBlurredByCancelButton=!0})},this.$scope)}cancelEditCategory(e){this.switchEditMode(e,!1),this.clearValidationForUpdateCategory(e)}switchEditMode(e,t){this.timeout(()=>{this.isInputBlurredByCancelButton=!t,this.currentEditedCategory=t?e:null,this.newCategoryName=t?e.localizableTitle.languageKey:"",e.ui.isEditMode=t},this.$scope),t&&this.timeout(()=>{this.addEventHandlerForEditCategory(e)},this.$scope)}validateCategory(e,t){const i=this.validationManager,s=i.execute("isEmpty",this.newCategoryName),a=!s&&i.execute("isCategoryDuplicate",this.newCategoryName,t),o=t?t.ui.form[e+t.id]:this.$scope.addCategoryForm[e];return o&&(s||a)&&(o.$setValidity("required",!s),o.$setValidity("nameDuplicate",!a),o.$setDirty()),!s&&!a}createCategory(){this.isInputBluredByCancelAdd||this.course.gradebook.categories.$create({title:this.newCategoryName}).$then(e=>{const t=this.categories.length;if(t>0){this.categoryService.reorderCategories(this.categories,t-1),this.cancelAddNewCategory();const i=this.$scope.addCategoryForm["add-new-category-input"];i&&i.$setPristine(),this.categoryService.updateCategoriesForCourse(this.course.id,e),e.permissions={delete:!0,edit:!0},this.timeout(()=>{this.addEventHandlerForEditCategory(e)},this.$scope)}})}addEventHandlerForEditCategory(e){a.element("#update-category-input-"+e.id).on("keydown",e=>{e.keyCode!==u.u||e.shiftKey||(this.isInputBlurredByCancelButton=!0)});const t=a.element("#cancel-update-category-button-"+e.id);t.on("mousedown",e=>{this.isInputBlurredByCancelButton=!0}),t.on("keydown",t=>{t.keyCode===u.u&&t.shiftKey?this.isInputBlurredByCancelButton=!1:t.keyCode===u.u&&(this.isInputBlurredByCancelButton=!1,this.validateAndUpdateCategory(e))})}deleteCategory(e){const t=this.categories[e];this.categories[e].$destroy().$allow(["400"]).$asPromise().then(e=>{e&&e.$response&&e.$response.data&&400===e.$response.data.status?this.$modal.open({template:$,scope:this.$scope,resolve:{translations:[h.serviceName,e=>e.loadBundle("features/course/grades/course-grades")]}}):this.categoryService.deleteCategoriesForCourse(this.course.id,t)})}updateCategory(e){this.isInputBlurredByCancelButton||(e.localizableTitle.languageKey=this.newCategoryName,e.title=e.localizableTitle.languageKey,e.$save(["title"]).$then(()=>{this.switchEditMode(e,!1),this.categoryService.updateCategoriesForCourse(this.course.id,e)}))}getCategoryIcon(e){return this.categoryService.getCategoryIcon(e)}validateAndAddCategory(){this.validateCategory("add-new-category-input")&&this.createCategory()}validateAndUpdateCategory(e){this.validateCategory("update-category-input-",e)&&this.updateCategory(e)}getCategoryMaxLength(){return 64}getCategoryMaxLengthDiff(){const e=this.$scope.addCategoryForm["add-new-category-input"].$error;return e&&e.maxlength?e.maxlength.diff:0}getCategoryMaxLengthDiffUpdate(e){const t=e.ui.form["update-category-input-"+e.id].$error;return t&&t.maxlength?t.maxlength.diff:0}showOptionsForCategory(e){return e.title!==N.KnownGradebookCategoryTitle.Attendance&&(!e.permissions||(e.permissions.delete||e.permissions.edit))}getCategoryOverflowMenu(e){const t=[];return e.permissions&&e.permissions.edit&&t.push({icon:"draw",onClick:()=>{this.editCategory(e)},labelKey:"global.edit"}),e.permissions&&e.permissions.delete&&t.push({icon:"trash",onClick:()=>{this.deleteCategory(this.categories.indexOf(e))},confirmationOptions:{lazyLoadTitleKeyAndInstructionsKey:()=>this.$q.when(g.a("x-bb-category-delete"))},labelKey:"global.delete"}),t}clearValidationForAddCategory(){const e=this.$scope.addCategoryForm["add-new-category-input"];e&&(e.$setValidity("required",!0),e.$setValidity("nameDuplicate",!0),e.$setPristine())}clearValidationForUpdateCategory(e){const t=e.ui.form["update-category-input-"+e.id];t&&(t.$setValidity("required",!0),t.$setValidity("nameDuplicate",!0),t.$setPristine())}getCodeOverflowMenu(e){const t=[];return e.model.permissions&&e.model.permissions.update&&t.push({icon:"draw",onClick:this.updateNotation.bind(this,e),labelKey:"global.edit"}),e.model.permissions&&e.model.permissions.delete&&t.push({icon:"trash",onClick:this.deleteNotation.bind(this,e),confirmationOptions:{lazyLoadTitleKeyAndInstructionsKey:()=>this.$q.when(g.a("x-bb-grade-notation"))},labelKey:"global.delete"}),t}get isNotationEditing(){return this.notations.some(e=>e.isEditing)}get activeNotation(){return this.notations.filter(e=>e.isEditing)[0]}showOptionsForNotation(e){const t=e.model.permissions;return!t||(t.delete||t.update)}createNotation(e){this.isNotationEditing||(e.stopPropagation(),this.buildNewNotation())}updateNotation(e){e.model.permissions.update&&!this.isNotationEditing&&(e.code=e.model.code,e.description=e.model.description,this.timeout(()=>{e.isEditing=!0},this.$scope))}leaveEditMode(e,t){this.isNotationEditing&&("cancel"===t?this.cancelEdit(e):(this.validateNotation(e),this.confirmEdit(e)),this.$scope.$broadcast("focus",this.focusNotationEventName))}confirmEdit(e){const t=this.isCodeValidate;let i=!1;if(e.model.code===e.code&&e.model.description===e.description||(i=!0),t)e.isEditing=!1,e.model.code=e.code,e.model.description=e.description,e.model.id?i&&e.model.$save().$then(e=>{this.$scope.$emit("grade-notation-update",this.course.id),this.$rootScope.$broadcast("bb-reload-grid-view")}):this.course.gradebook.performancecodes.$create(e.model).$then(t=>{e.model=t,this.$scope.$emit("grade-notation-update",this.course.id),this.$rootScope.$broadcast("bb-reload-grid-view")});else{const t=e.form["title-"+e.id],i=e.form["detail-"+e.id];t.$setTouched(),i.$setTouched()}}cancelEdit(e){e.isEditing=!1,""!==e.model.code&&""!==e.model.description||this.deleteNotation(e)}validateNotation(e){const t=e.form["title-"+e.id],i=e.form["detail-"+e.id],s=this.validationManager,a=s.execute("isEmpty",e.code),o=s.execute("isNotationNumberOnly",e.code),n=s.execute("isEmpty",e.description),r=s.execute("isNotationExist",e),c=s.execute("isNotationSchemaDuplicate",e),l=e=>{t.$setValidity("required","isNotationEmpty"!==e),t.$setValidity("notationNumberOnly","isNotationNumberOnly"!==e),t.$setValidity("notationExist","isNotationExist"!==e),t.$setValidity("notationSchemaDuplicate","isNotationSchemaDuplicate"!==e),i.$setValidity("required","descriptionEmpty"!==e)};a?l("isNotationEmpty"):o?l("isNotationNumberOnly"):r?l("isNotationExist"):c?l("isNotationSchemaDuplicate"):n?l("descriptionEmpty"):l(),t.$setDirty(),i.$setDirty(),this.isCodeValidate=!(a||o||n||r||c)}deleteNotation(e){const t=this.notations.indexOf(e);e.model.$destroy().$allow(["400"]).$asPromise().then(e=>{this.$scope.$emit("grade-notation-update",this.course.id),this.notations.splice(t,1),this.$rootScope.$broadcast("bb-reload-grid-view")})}buildNewNotation(){const e={id:this.generateNotationId(),code:"",description:"",model:this.GradeNotationModel.$build({code:"",description:"",permissions:{delete:!0,update:!0}}),isEditing:!0};return this.notations.push(e),e}generateNotationId(){return"grade_notation_"+e.uid++}pastDueCheckboxEvent(){this.$scope.$broadcast(y.b,this.isPastZeroAssigned)}automaticZeroConfirm(e){let t;this.isPastZeroAssigned?(t={countUnsubmittedWorkAsZero:!0},delete this.gradebookSettings.retainAutoZero):(c.a.Retain.isEqualTo(e.choice)&&(t={countUnsubmittedWorkAsZero:!1,retainAutoZero:!0}),c.a.Delete.isEqualTo(e.choice)&&(t={countUnsubmittedWorkAsZero:!1,retainAutoZero:!1})),this.updatePastDueZero(t)}automaticZeroCancel(){this.isPastZeroAssigned=!this.isPastZeroAssigned}updatePastDueZero(e){Object.assign(this.gradebookSettings,e),this.gradebookSettings.$patch().$then(()=>{this.$rootScope.$broadcast(D)})}};_.STUDENT_FAILING_PREFERENCE_KEY="telem.threshold.failing.grade",_.STUDENT_ABSENT_PREFERENCE_KEY="telem.threshold.days.absent",_.STUDENT_ALERTS_ENABLED="telem.student.alerts.enabled",_.STUDENT_ABSENT_DEFAULT=5,_.DISABLE_ABSENT_NOTICES=0,_.INITIAL_FAILING_PREF_ARGS={key:_.STUDENT_FAILING_PREFERENCE_KEY},_.INITIAL_ABSENT_PREF_ARGS={key:_.STUDENT_ABSENT_PREFERENCE_KEY},_.INITIAL_ENABLE_PREF_ARGS={key:_.STUDENT_ALERTS_ENABLED,defaultValue:"true"},_.uid=0,_=Object(s.__decorate)([Object(s.__param)(0,Object(o.b)("$scope")),Object(s.__param)(1,Object(o.b)("$rootScope")),Object(s.__param)(2,Object(o.b)("$q")),Object(s.__param)(3,Object(o.b)("currentCourse")),Object(s.__param)(4,Object(o.b)("$modal")),Object(s.__param)(5,Object(o.b)(h.serviceName)),Object(s.__param)(6,Object(o.b)(m.b)),Object(s.__param)(7,Object(o.b)("GradeNotationModel")),Object(s.__param)(8,Object(o.b)(p.d)),Object(s.__param)(9,Object(o.b)(l.b)),Object(s.__param)(10,Object(o.b)(d.b)),Object(s.__param)(11,Object(o.b)(S.b)),Object(s.__param)(12,Object(o.b)(b.b)),Object(s.__param)(13,Object(o.b)(f.b)),Object(s.__param)(14,Object(o.b)(C.b)),Object(s.__param)(15,Object(o.b)(v.i))],_);class I extends _{}},"70Xn":function(e,t){e.exports='<bb-modal class="notification automatic-zero-confirmation" \n          modal-translate-options="modalTranslateOptions"\n          modal-aria-type="alertdialog"\n          analytics-id-tag-prefix="components.directives.pastDueZero">\n  <div name="modal-contents">\n    \x3c!-- Instructions --\x3e\n    <p bb-translate>{{ modalTranslateOptions.instructions.key }}</p>\n  </div>\n  <button name="modal-footer-button-primary" \n          type="button" \n          class="button confirm-ok js-primary-button" \n          ng-click="okAction()" \n          analytics-id="course.grades.pastDue.confirmationNeeded.confirm"\n          bb-translate>\n          course.grades.pastDue.confirmationNeeded.confirm\n  </button>\n  <button name="modal-footer-button-secondary" \n          type="button" \n          class="button button--secondary confirm-cancel js-secondary-button" \n          ng-click="cancelAction()" \n          analytics-id="course.grades.pastDue.confirmationNeeded.cancel"\n          bb-translate>\n          course.grades.pastDue.confirmationNeeded.cancel\n  </button>\n</bb-modal>'},MoIS:function(e,t,i){"use strict";var s=i("Llzl"),a=i("0JpG"),o=i("tka7"),n=i("70Xn"),r=i("tmbA");i.d(t,"c",(function(){return c})),i.d(t,"a",(function(){return l})),i.d(t,"b",(function(){return d}));const c="ultraUi.components.directives.grade.pastDueZero",l="bb-past-due-zero-confirmation",d="bb-past-due-zero-settings",u="course.grades.pastDue.confirmationNeeded.";class h{constructor(e,t,i,s,a){this.scope=e,this.element=t,this.attrs=i,this.$modal=s,this.bbLocalize=a,this.scope.$on(l,(e,t)=>{this.displayPastDueConfirmation(t)}),this.scope.$on(d,(e,t)=>{this.isPastZeroAssigned=t,this.displayPastDueConfirmation()})}displayPastDueConfirmation(e){e?this.initModalTranslateOptions(e):this.initModalTranslateOptions();let t=!1;const i=this.scope;this.$modal.open({template:e?n:r,scope:i,resolve:{translations:[a.serviceName,e=>e.loadBundle("course/grades/pastDue/confirmationNeeded")]},controller:["$scope",a.serviceName,function(e,s){e.okAction=()=>{e.$close(),t=!0},e.cancelAction=()=>{e.$close(),t=!1,i.cancelCallback&&i.cancelCallback()}}]}).result.then(()=>{t&&this.scope.confirmCallback&&(this.isPastZeroAssigned?this.scope.confirmCallback():this.scope.confirmCallback({args:{choice:this.scope.modalTranslateOptions.choiceModal}}))},()=>{this.scope.dismissCallback&&this.scope.dismissCallback()})}initModalTranslateOptions(e){if(e)return this.scope.modalTranslateOptions={title:{key:u+"title"},instructions:{key:u+e+".instructions"}};const t=this.isPastZeroAssigned?"assign":"unassign";if(this.scope.modalTranslateOptions={title:{key:u+t+".title"},instructions:{key:u+t+".instructions"},confirm:{key:u+t+".confirm"},cancel:{key:u+t+".cancel"}},!this.isPastZeroAssigned){const e=[{id:"past-due-unassign-retain",name:"pastDueUnassignZero",value:o.a.Retain.toString(),localizedKey:u+"unassign.choices.retain"},{id:"past-due-unassign-delete",name:"pastDueUnassignZero",value:o.a.Delete.toString(),localizedKey:u+"unassign.choices.delete",descriptionKey:u+"unassign.choices.instructions"}];Object.assign(this.scope.modalTranslateOptions,{choices:e,choiceModal:e[0].value})}return this.scope.modalTranslateOptions}}h.$inject=["scope","element","attrs","$modal",a.serviceName];class m{constructor(e){this.$injector=e,this.restrict="E",this.template=n,this.scope={confirmCallback:"&?",cancelCallback:"&?",dismissCallback:"&?"},this.link=(e,t,i)=>{e.pastDueZero=this.$injector.instantiate(h,{scope:e,element:t,attrs:i})}}}m.$inject=["$injector"],s.module(c,[]).directive("bbPastDueZero",["$injector",e=>e.instantiate(m)])},cR84:function(e,t){e.exports='<bb-modal class="notification js-dismiss-modal" role="alertdialog" bb-translate-attrs="{\'aria-label\': \'course.grades.settings.categorySettings.deleteAlert.title\'}"\n          modal-title-key="course.grades.settings.categorySettings.deleteAlert.title"\n          analytics-id-tag-prefix="course.grades.settings.categorySettings.deleteAlert">\n  <div name="modal-contents">\n    <bb-translate>course.grades.settings.categorySettings.deleteAlert.content</bb-translate>\n  </div>\n  <button name="modal-footer-button-primary" \n          ng-click="$parent.$dismiss()" \n          class="button js-primary-button"\n          analytics-id="course.grades.settings.categorySettings.deleteAlert.ok.button">\n    <span bb-translate="course.grades.settings.categorySettings.deleteAlert.ok-button"></span>\n  </button>\n</bb-modal>'},r6lH:function(e,t,i){"use strict";i.d(t,"a",(function(){return h})),i.d(t,"b",(function(){return m}));var s=i("nsO7"),a=i("Llzl"),o=i("jhBu"),n=i("Sa5G"),r=i("0JpG"),c=i("pjml"),l=i("wgY5"),d=i("nmzr"),u=i("+O05");const h="ultra.service.telemetry",m="telemetry";class p{constructor(e,t,i,s,a,o,n,r,c,l,d,u,h,m,p,g,y){this.cacheFactory=e,this.$q=t,this.entitlement=i,this.bbLocalize=s,this.ActivityVsGradeModel=a,this.ContentActivityInDetailModel=o,this.CourseActivityModel=n,this.CourseGradesModel=r,this.CourseNotificationsModel=c,this.MultimediaActivityInDetailModel=l,this.MultimediaStatisticsModel=d,this.NotificationUsers=u,this.StudentActivityModel=h,this.StudentGradesModel=m,this.SufficientDataModel=p,this.TelemetryDiscussionActivityModel=g,this.TelemetryDiscussionXrayModel=y,this.SUFFICIENT_DATA_KEY="SufficientData",this.sufficientDataCache=e.createCache("sufficientTelemetryData"),this.notificationsCache=e.createCache("notifications")}loadActivityVsGradeData(e){return this.ActivityVsGradeModel.$find(e).$allow([404]).$asPromise()}loadStudentGradeData(e,t){return this.StudentGradesModel.$find(e,t?{userId:t}:{}).$allow([404,400]).$asPromise()}loadCourseGradeData(e){return this.CourseGradesModel.$find(e).$allow([404,400]).$asPromise()}loadStudentActivityData(e,t){return this.StudentActivityModel.$find(e,t?{userId:t}:{}).$allow([400]).$asPromise()}loadContentActivityInDetailData(e,t){return this.ContentActivityInDetailModel.$collection().getContentActivityInDetail(e,t).$asPromise()}loadMultimediaActivityInDetailData(e,t){return this.MultimediaActivityInDetailModel.$collection().getMultimediaActivityInDetail(e,t).$asPromise()}loadMultimediaStatisticsData(e,t){return this.MultimediaStatisticsModel.getMultimediaStatistics(e,t).$asPromise()}loadCourseActivityData(e){return this.CourseActivityModel.$find(e).$allow([400]).$asPromise()}loadNotificationUsers(e,t,i){const a={};return t&&(a.limit=t),i&&(a.offset=i),this.NotificationUsers.$find(e,a).$asPromise().then(e=>s.keyBy(e.users,"userId"))}loadNotifications(e,t,i,s){return this.getNotificationsPromise(e,t,i,s).promise}loadDiscussionActivityData(e,t,i){return i?this.TelemetryDiscussionActivityModel.getDiscussionActivityReport(e,t,i).$asPromise():this.TelemetryDiscussionActivityModel.getDiscussionActivityReport(e,t).$asPromise()}loadDiscussionXrayReport(e,t,i){return this.TelemetryDiscussionXrayModel.getDiscussionXrayReport(e,t,i).$asPromise()}hasSufficientActivityData(e){return this.getSufficientDataPromise().promise.then(t=>!(!t||!t.coursesWithActivity)&&s.includes(t.coursesWithActivity,e))}hasSufficientGradeData(e){return this.getSufficientDataPromise().promise.then(t=>!(!t||!t.coursesWithGrades)&&s.includes(t.coursesWithGrades,e))}canViewAllUserData(e){return this.entitlement.hasCourseEntitlement(n.n.ViewGrades,e)}formatMessageRecipients(e){return(e||[]).map(e=>e.id).join(",")}determineContentSupportsActivityData(e){const t=this.$q.defer();return u.a.isExternalSubmissionsAssessment(e)?t.resolve(!1):this.contentSupportsActivityData(e)?this.canViewAllUserData(e.courseId).then(e=>{t.resolve(e)}).catch(e=>{t.reject(e)}):t.resolve(!1),t.promise}contentSupportsActivityData(e){return(n.f.TestLink.isEqualTo(e.contentHandler)||n.f.UltraAssignment.isEqualTo(e.contentHandler))&&e.hasGradingColumn()}determinePanelSref(e,t){return this.canViewAllUserData(e).then(i=>i?this.createPanelSref(d.TelemetryViewType.INSTRUCTOR_CLASS,e,t):this.createPanelSref(d.TelemetryViewType.STUDENT_PROGRESS,e,t))}createPanelSref(e,t,i){let s='({ courseId: "'+t+'"';return i&&(s+=', notificationId: "'+i+'"'),e.toString()+(s+=" })")}exportFilename(e,t,i,s,a){let o="";e&&(o=e.courseId+"_");const n=this.bbLocalize.formatDateSync(new Date,r.ILocaleDateFormat.ISO).replace(/[^0-9]/g,"");let c="";t&&i&&t.id!==i.id&&(c=t.userName+"_");const l=s?"_"+s:"";let d="";return a&&(d=a.replace(/\s+/g,"_")+"_"),o+c+d+n+l}getSufficientDataPromise(){let e=this.sufficientDataCache.get(this.SUFFICIENT_DATA_KEY);return e||(e={promise:this.SufficientDataModel.$new().$fetch().$allow([404,400]).$asPromise()},this.sufficientDataCache.put(this.SUFFICIENT_DATA_KEY,e)),e}getNotificationsPromise(e,t,i,s){const a=e+t+i+s;let o=this.notificationsCache.get(a);if(!o){const n={};t&&(n.userId=t),i&&(n.includeDismissed=i),s&&(n.notificationType=s),(o={promise:this.CourseNotificationsModel.$find(e,n).$asPromise()}).promise.then(e=>(e.currentStudent.forEach(e=>{e.ui={createdDay:l.utc(e.created).startOf("day").toDate()}}),e)),this.notificationsCache.put(a,o)}return o}}p.$inject=["DSCacheFactory","$q",o.b,r.serviceName,c.sb.serviceName,c.tb.serviceName,c.ub.serviceName,c.vb.serviceName,c.wb.serviceName,c.zb.serviceName,c.Ab.serviceName,c.Cb.serviceName,c.Db.serviceName,c.Eb.serviceName,c.Fb.serviceName,c.xb.serviceName,c.yb.serviceName];class g extends p{}a.module(h,[c.N,o.a]).service(m,p)},tka7:function(e,t,i){"use strict";i.d(t,"a",(function(){return o}));var s=i("nbDY"),a=i.n(s);class o extends a.a{}o.Assign=new o("assign"),o.Unassign=new o("unassign"),o.Delete=new o("delete"),o.Retain=new o("retain")},tmbA:function(e,t){e.exports='<bb-modal class="notification automatic-zero-setting-confirmation"\n          modal-translate-options="modalTranslateOptions"\n          modal-aria-type="alertdialog"\n          analytics-id-tag-prefix="components.directives.pastDueZeroSettings">\n  <div name="modal-contents">\n    \x3c!-- Instructions --\x3e\n    <p bb-translate>{{ modalTranslateOptions.instructions.key }}</p>\n    \x3c!-- Past due zero: Unassign zero --\x3e\n    <div ng-if="!pastDueZero.isPastZeroAssigned">\n      <fieldset ng-if="modalTranslateOptions.choices && modalTranslateOptions.choices.length > 0"\n                class="fieldset-options">\n        <legend class="sr-only" bb-translate="{{ modalTranslateOptions.title.key }}"></legend>\n        <div class="option-item" ng-repeat="option in modalTranslateOptions.choices">\n          <input type="radio" \n                 name="{{ ::option.name }}" \n                 id="{{ ::option.id }}"\n                 ng-model="modalTranslateOptions.choiceModal"\n                 ng-value="option.value"\n                 analytics-id="components.directives.grade.pastDueZero.option.input.radio">\n          <label for="{{ ::option.id }}" bb-translate>{{ ::option.localizedKey }}</label>\n          <p ng-if="!!option.descriptionKey"\n             class="past-due-unassign-description"\n             bb-translate>\n            {{ ::option.descriptionKey }}\n          </p>\n        </div>\n      </fieldset>\n    </div>\n  </div>\n  <button name="modal-footer-button-primary" \n          type="button" \n          class="button confirm-ok js-primary-button" \n          ng-click="okAction()" \n          analytics-id="{{modalTranslateOptions.confirm.key}}"\n          bb-translate>\n    {{modalTranslateOptions.confirm.key}}\n  </button>\n  <button name="modal-footer-button-secondary" \n          type="button" \n          class="button button--secondary confirm-cancel js-secondary-button" \n          ng-click="cancelAction()" \n          analytics-id="{{modalTranslateOptions.cancel.key}}"\n          bb-translate>\n    {{modalTranslateOptions.cancel.key}}\n  </button>\n</bb-modal>'}}]);